import { CalculatorContent } from "@/types";

export const APPRAISAL_GAP_COVERAGE_CALCULATOR_CONTENT: CalculatorContent = {
  title: "Appraisal Gap Coverage Calculator | Low Appraisal Strategy Tool",
  description:
    "Calculate how much appraisal gap coverage to offer when buying a home. Protect yourself from low appraisals while making competitive offers in hot markets.",
  icon: "Icon",
  category: "Calculators",
  slug: "appraisal-gap-coverage-calculator",
  article: {
    title: "Appraisal Gap Coverage: Compete Without Overpaying",
    content: `
# Appraisal Gap Coverage Calculator: Navigate Low Appraisals Strategically

In competitive markets where homes sell above asking price, appraisal gaps are common. This calculator helps you determine how much to offer in appraisal gap coverage to make your offer competitive while protecting your finances.

## What is an Appraisal Gap?

**The Scenario**:
- Offer price: $450,000
- Appraisal value: $430,000
- **Appraisal gap**: $20,000

**The Problem**:
Lenders only loan based on the LOWER of purchase price or appraised value. You're short $20,000.

**Your Options**:
1. Negotiate price down to appraisal
2. Cover gap with extra cash
3. Walk away (if you have appraisal contingency)
4. Split the difference with seller

## What is Appraisal Gap Coverage?

**Appraisal gap coverage** is a clause in your offer stating you'll pay up to a certain amount above the appraised value if the home appraises low.

**Example clause**:
"Buyer agrees to cover up to $25,000 of any appraisal gap"

**Translation**: If home appraises $25,000 or less below offer price, you'll pay the difference in cash. If gap is larger, you can renegotiate or walk away.

## Why Offer Appraisal Gap Coverage?

### Makes Your Offer More Competitive
**Seller's perspective**:
- Reduces their risk of deal falling through
- Shows you're financially strong
- Demonstrates serious commitment
- Often more valuable than slightly higher price

**Your advantage**:
- Can win without highest offer price
- Might beat higher offers with weaker terms
- Shows sophistication
- Signals cash reserves

### When It Makes Sense

âœ… **Competitive multiple-offer situations**
âœ… **Offering above asking in hot market**
âœ… **Home might be slightly overpriced**
âœ… **You have extra cash reserves**
âœ… **Seller is risk-averse**
âœ… **You really want this specific home**

âŒ **Don't use if**:
- Home priced at/below market
- Slow market conditions
- You're already stretching finances
- No extra cash available
- Home has red flags

## How Much Gap Coverage to Offer

### Conservative Approach: $5,000 - $10,000
**When to use**:
- Offering at or slightly above asking
- Moderate competition
- Home fairly priced
- Limited cash reserves

**Pros**: Minimal financial risk
**Cons**: Might not differentiate enough

### Moderate Approach: $10,000 - $25,000
**When to use**:
- Offering 3-7% above asking
- Strong competition (3-5+ offers)
- Home priced reasonably
- Good cash reserves available

**Pros**: Competitive without excessive risk
**Cons**: Ties up significant cash

### Aggressive Approach: $25,000 - $50,000+
**When to use**:
- Offering 8%+ above asking
- Very hot market
- Dream home worth stretching for
- Strong cash position
- Luxury price range

**Pros**: Very competitive
**Cons**: Significant cash commitment

## Calculating Your Gap Coverage Amount

### Formula 1: Percentage of Over-Asking

**If offering above asking price**:
Gap coverage = 50-100% of amount over asking

**Example**:
- Asking price: $400,000
- Your offer: $425,000 (6.25% over)
- Over-asking amount: $25,000
- **Suggested gap coverage**: $12,500 - $25,000

**Rationale**: If home is priced correctly, it should appraise near asking. Your over-asking amount represents the risk.

### Formula 2: Fixed Percentage of Offer

**Standard coverage**: 2-5% of offer price

**Example**:
- Offer price: $450,000
- 2% coverage: $9,000
- 3% coverage: $13,500
- 5% coverage: $22,500

**Sweet spot**: 3-4% for most situations

### Formula 3: Available Cash Reserves

**Conservative**: Offer 25% of available cash
**Moderate**: Offer 33% of available cash
**Aggressive**: Offer 50% of available cash

**Example**:
- Cash available (after down payment & closing): $60,000
- Conservative gap coverage: $15,000
- Moderate gap coverage: $20,000
- Aggressive gap coverage: $30,000

**Warning**: Don't deplete emergency fund!

## Real-World Scenarios

### Scenario 1: Moderate Competition
**Situation**:
- List price: $375,000
- Your offer: $385,000
- Competition: 3 other offers expected
- Cash reserves: $40,000

**Strategy**:
- Gap coverage: $10,000-15,000
- This covers 67-100% of over-asking amount
- Reasonable risk, competitive positioning

**Likely outcome**: Competitive offer

### Scenario 2: Hot Market, Multiple Offers
**Situation**:
- List price: $500,000
- Your offer: $540,000 (8% over)
- Competition: 7+ offers expected
- Cash reserves: $80,000

**Strategy**:
- Gap coverage: $25,000-40,000
- Covers 62-100% of over-asking
- Combined with other strong terms
- Shows very serious intent

**Likely outcome**: Very competitive, good win chance

### Scenario 3: Fairly Priced Home
**Situation**:
- List price: $325,000
- Your offer: $330,000 (minimal over)
- Competition: Moderate (2-3 offers)
- Cash reserves: $25,000

**Strategy**:
- Gap coverage: $5,000-7,500
- Low risk (home should appraise at list)
- Still shows commitment
- Protects most of your cash

**Likely outcome**: Competitive enough for this situation

## Structuring Your Gap Coverage Clause

### Basic Template

"Buyer agrees to pay up to $[AMOUNT] above the appraised value if the appraisal comes in below the purchase price."

### Enhanced Version

"Buyer agrees to cover up to $[AMOUNT] of any difference between the purchase price and the appraised value, with such amount to be paid in cash at closing in addition to the down payment."

### With Cap and Conditions

"Buyer will cover appraisal gap up to $[AMOUNT], provided:
1. Appraisal is conducted by licensed appraiser
2. Appraisal report is provided to buyer within [X] days
3. Total purchase price not to exceed $[MAXIMUM]"

## Strategic Combinations

### Gap Coverage + Escalation Clause
**Power combo**:
"I'll beat any offer by $5,000 up to $450,000 AND cover $20,000 appraisal gap"

**Effect**: Extremely competitive for both price and terms

### Gap Coverage + Waived Appraisal Contingency
**Ultimate competition**:
"I waive the appraisal contingency entirely"

**Meaning**: You'll buy at offer price regardless of appraisal

**Warning**: âš ï¸ Very risky! Only for cash buyers or those with huge reserves

### Gap Coverage + Quick Close
"Cover $15,000 gap + close in 21 days"

**Effect**: Solves seller's two biggest concerns (price and timing)

## Risks of Appraisal Gap Coverage

### Financial Risks

**1. Depletes Cash Reserves**
- Money you might need for repairs
- Emergency fund reduction
- Less cushion for unexpected costs

**2. Overpaying for Home**
- If appraisal is accurate, you paid too much
- Affects future equity
- Harder to refinance or sell short-term

**3. Limits Negotiating Power**
- Committed to higher price
- Can't use low appraisal to renegotiate
- Stuck if inspection reveals issues

### Market Risks

**1. Declining Market**
- Home value might drop further
- Underwater on mortgage possible
- Harder to sell/refinance

**2. Inaccurate Appraisal**
- Appraisal might be right, your offer wrong
- Market could be overheated
- Comps might not support value

## Protecting Yourself

### 1. Set Reasonable Maximum
Don't offer unlimited gap coverage

**Bad**: "Will cover any appraisal gap"
**Good**: "Will cover up to $20,000 appraisal gap"

### 2. Do Your Own Valuation
Before offering gap coverage:
- Research comparable sales
- Analyze price per square foot
- Consider condition vs comps
- Factor in market trends

### 3. Order Pre-Inspection
Know what you're paying for:
- Major systems condition
- Needed repairs
- Deal-breaker issues
- True home value

### 4. Keep Cash Reserves
Never offer more gap coverage than you can afford:
- Maintain 3-6 month emergency fund
- Keep repair/renovation budget
- Plan for closing cost overages
- Save moving expense money

### 5. Know Your Financing
Understand loan implications:
- Higher purchase price = higher loan amount
- Affects debt-to-income ratio
- Might exceed loan limits
- Could impact approval

## When Appraisal Comes In Low

### If You Have Gap Coverage Clause

**Step 1: Review the Appraisal**
- Check for errors or missed features
- Compare comps used
- Verify home details accurate
- Consider appraisal challenge

**Step 2: Calculate the Gap**
- Offer price: $450,000
- Appraised value: $435,000
- Gap: $15,000
- Your coverage: $20,000
- **You're covered**: Pay the $15,000

**Step 3: Prepare Funds**
- Increase cash to close
- Adjust loan amount down
- Keep down payment percentage same
- Bring extra $15,000 to closing

### If Gap Exceeds Your Coverage

**Example**:
- Offer price: $450,000
- Appraised value: $420,000
- Gap: $30,000
- Your coverage: $20,000
- **Shortfall**: $10,000

**Your options**:
1. **Negotiate with seller** to meet in middle
2. **Walk away** (if you have appraisal contingency for excess)
3. **Pay the full gap** if you really want the home
4. **Challenge the appraisal** (might take time)

## Alternative Strategies

### Instead of Gap Coverage

**1. Waive Appraisal Contingency Entirely**
- Even more competitive
- But much riskier
- Need substantial cash

**2. Higher Down Payment**
- More equity from start
- Less appraisal risk
- Protects against gap

**3. Seller Concessions**
- Ask seller to pay closing costs
- Effectively lowers your cash needed
- Can offset gap coverage risk

**4. Choose Different Home**
- Less competitive situation
- Priced more fairly
- Won't need gap coverage

## Market-Specific Guidance

### Hot Markets (Seller's Market)
- Gap coverage often expected
- Offer 3-5% of purchase price
- Combine with other strong terms
- Be prepared to pay it

### Balanced Markets
- Gap coverage gives edge
- Offer 2-3% of purchase price
- May not be necessary
- Use strategically

### Buyer's Markets
- Usually unnecessary
- Save your cash
- Use appraisal as negotiating tool
- Sellers should come down

## Using This Calculator

**Input your details**:
1. Offer price
2. Listing/asking price
3. Available cash reserves
4. Expected competition level
5. Your risk tolerance

**Calculator provides**:
1. **Recommended gap coverage amount**
2. **Risk level assessment**
3. **Cash requirement scenarios**
4. **Competitive impact analysis**
5. **Alternative strategies**

## Final Tips

### Do:
âœ… Research comparable sales first
âœ… Keep enough emergency fund
âœ… Set maximum coverage limit
âœ… Understand your total cash needs
âœ… Get pre-approved for higher amount
âœ… Order pre-inspection if possible
âœ… Challenge unfair appraisals

### Don't:
âŒ Offer unlimited coverage
âŒ Deplete all savings
âŒ Ignore warning signs about value
âŒ Skip your own valuation research
âŒ Assume appraisal will be fine
âŒ Forget about closing costs
âŒ Use in non-competitive situations

**Remember**: Appraisal gap coverage is a powerful tool to win in competitive markets, but it must be used wisely. Only offer what you can truly afford and what the home is genuinely worth to you!
    `,
  },
  calculator: {
    fields: [
      {
        name: "offerPrice",
        label: "Your Offer Price ($)",
        type: "number",
        defaultValue: "450000",
      },
      {
        name: "listingPrice",
        label: "Listing/Asking Price ($)",
        type: "number",
        defaultValue: "425000",
      },
      {
        name: "cashReserves",
        label: "Available Cash Reserves (after down payment & closing) ($)",
        type: "number",
        defaultValue: "50000",
      },
      {
        name: "competitionLevel",
        label: "Expected Competition Level",
        type: "select",
        options: [
          { value: "low-1-2-offers", label: "Low (1-2 offers)" },
          { value: "moderate-3-4-offers", label: "Moderate (3-4 offers)" },
          { value: "high-5-6-offers", label: "High (5-6 offers)" },
          { value: "very-high-7-plus-offers", label: "Very High (7+ offers)" }
        ],
        defaultValue: "moderate-3-4-offers",
      },
      {
        name: "riskTolerance",
        label: "Your Risk Tolerance",
        type: "select",
        options: [
          { value: "conservative", label: "Conservative" },
          { value: "moderate", label: "Moderate" },
          { value: "aggressive", label: "Aggressive" }
        ],
        defaultValue: "moderate",
      },
    ],
    results: [
      {
        label: "Recommended Gap Coverage",
        isCurrency: true,
      },
      {
        label: "Gap Coverage Range",
        isCurrency: false,
      },
      {
        label: "Risk Assessment",
        isCurrency: false,
      },
      {
        label: "Cash Requirement Scenarios",
        isCurrency: false,
      },
      {
        label: "Strategic Recommendation",
        isCurrency: false,
      },
    ],
    calculate: (values) => {
      const {
        offerPrice,
        listingPrice,
        cashReserves,
        competitionLevel,
        riskTolerance,
      } = values;

      const offer = parseFloat(offerPrice);
      const listing = parseFloat(listingPrice);
      const cash = parseFloat(cashReserves);

      const overAskingAmount = offer - listing;
      const overAskingPercent = (overAskingAmount / listing) * 100;

      // Calculate recommended coverage based on multiple factors
      let baseRecommendation = 0;
      
      // Factor 1: Amount over asking (50-100% of over-asking)
      if (overAskingAmount > 0) {
        if (riskTolerance === "conservative") {
          baseRecommendation = overAskingAmount * 0.5;
        } else if (riskTolerance === "moderate") {
          baseRecommendation = overAskingAmount * 0.75;
        } else {
          baseRecommendation = overAskingAmount;
        }
      } else {
        // If at or below asking, use percentage of offer
        const percentOfOffer = riskTolerance === "conservative" ? 0.02 : riskTolerance === "moderate" ? 0.03 : 0.04;
        baseRecommendation = offer * percentOfOffer;
      }

      // Factor 2: Adjust for competition
      let competitionMultiplier = 1.0;
      if (competitionLevel === "low-1-2-offers") competitionMultiplier = 0.8;
      else if (competitionLevel === "moderate-3-4-offers") competitionMultiplier = 1.0;
      else if (competitionLevel === "high-5-6-offers") competitionMultiplier = 1.3;
      else competitionMultiplier = 1.6;

      baseRecommendation *= competitionMultiplier;

      // Factor 3: Cap at available cash
      const maxSafeCoverage = cash * (riskTolerance === "conservative" ? 0.25 : riskTolerance === "moderate" ? 0.33 : 0.5);
      const recommendedCoverage = Math.min(baseRecommendation, maxSafeCoverage);

      // Calculate range
      const minCoverage = recommendedCoverage * 0.7;
      const maxCoverage = Math.min(recommendedCoverage * 1.3, maxSafeCoverage);

      const coverageRange = `$${Math.round(minCoverage).toLocaleString()} - $${Math.round(maxCoverage).toLocaleString()}`;

      // Risk assessment
      const cashPercentUsed = (recommendedCoverage / cash) * 100;
      let riskAssessment = "";
      
      if (cashPercentUsed <= 20) {
        riskAssessment = `âœ… LOW RISK: Coverage uses only ${cashPercentUsed.toFixed(1)}% of your cash reserves. You'll maintain healthy emergency fund.`;
      } else if (cashPercentUsed <= 35) {
        riskAssessment = `âš ï¸ MODERATE RISK: Coverage uses ${cashPercentUsed.toFixed(1)}% of your cash reserves. Ensure you keep emergency fund intact.`;
      } else if (cashPercentUsed <= 50) {
        riskAssessment = `âš ï¸ ELEVATED RISK: Coverage uses ${cashPercentUsed.toFixed(1)}% of your cash reserves. You'll have limited cushion for repairs/emergencies.`;
      } else {
        riskAssessment = `âŒ HIGH RISK: Coverage uses ${cashPercentUsed.toFixed(1)}% of your cash reserves. Strongly reconsider or reduce coverage amount.`;
      }

      // Cash requirement scenarios
      const likelyAppraisal = offer * 0.97; // Assume 3% under offer
      const worstCaseAppraisal = offer * 0.93; // Assume 7% under offer
      
      const likelyGap = offer - likelyAppraisal;
      const worstGap = offer - worstCaseAppraisal;
      
      const scenarios = `
ðŸ“Š APPRAISAL SCENARIOS:

Best Case (appraises at offer of $${offer.toLocaleString()}):
  â†’ No gap, you pay $0 extra
  â†’ Coverage not needed

Likely Case (appraises 3% low at $${likelyAppraisal.toLocaleString()}):
  â†’ Gap: $${likelyGap.toLocaleString()}
  â†’ Your coverage: $${recommendedCoverage.toLocaleString()}
  â†’ ${likelyGap <= recommendedCoverage ? 'âœ… COVERED' : `âŒ Short $${(likelyGap - recommendedCoverage).toLocaleString()}`}

Worst Case (appraises 7% low at $${worstCaseAppraisal.toLocaleString()}):
  â†’ Gap: $${worstGap.toLocaleString()}
  â†’ Your coverage: $${recommendedCoverage.toLocaleString()}
  â†’ ${worstGap <= recommendedCoverage ? 'âœ… COVERED' : `âŒ Short $${(worstGap - recommendedCoverage).toLocaleString()} - Can walk away or negotiate`}
      `;

      // Strategic recommendation
      let strategy = "";
      
      if (overAskingPercent <= 2) {
        strategy = `ðŸ’¡ LOW OVER-ASKING SITUATION\n\nYou're offering ${overAskingPercent.toFixed(1)}% above asking. Appraisal risk is minimal.\n\nâ€¢ Home should appraise close to offer\nâ€¢ Gap coverage of $${Math.round(recommendedCoverage).toLocaleString()} shows good faith\nâ€¢ Combined with strong terms, makes competitive offer\nâ€¢ Low financial risk for you`;
      } else if (overAskingPercent <= 7) {
        strategy = `âš ï¸ MODERATE OVER-ASKING SITUATION\n\nYou're offering ${overAskingPercent.toFixed(1)}% above asking. Appraisal gap possible.\n\nâ€¢ Research recent comparable sales carefully\nâ€¢ Gap coverage of $${Math.round(recommendedCoverage).toLocaleString()} is competitive\nâ€¢ Consider pre-inspection to verify value\nâ€¢ Have full gap amount available just in case\nâ€¢ Combine with: ${competitionLevel === "very-high-7-plus-offers" ? "escalation clause, quick close" : "strong terms, flexible timeline"}`;
      } else {
        strategy = `âŒ HIGH OVER-ASKING SITUATION\n\nYou're offering ${overAskingPercent.toFixed(1)}% above asking. Significant appraisal risk!\n\nâš ï¸ WARNING SIGNS:\nâ€¢ Large gap ($${overAskingAmount.toLocaleString()}) very likely\nâ€¢ You'll probably need full $${Math.round(recommendedCoverage).toLocaleString()}\nâ€¢ Risk of overpaying for property\nâ€¢ Could impact future equity\n\nâœ… RECOMMENDATIONS:\nâ€¢ Get pre-inspection before committing\nâ€¢ Research comps thoroughly - is price justified?\nâ€¢ Have $${Math.round(maxCoverage).toLocaleString()} cash ready\nâ€¢ Consider offering less or choosing different home\nâ€¢ If proceeding: Waive appraisal contingency entirely to maximize competitiveness`;
      }

      return [
        {
          label: "Recommended Gap Coverage",
          value: recommendedCoverage.toFixed(2),
          isCurrency: true,
        },
        {
          label: "Gap Coverage Range",
          value: coverageRange,
          isCurrency: false,
        },
        {
          label: "Risk Assessment",
          value: riskAssessment,
          isCurrency: false,
        },
        {
          label: "Cash Requirement Scenarios",
          value: scenarios,
          isCurrency: false,
        },
        {
          label: "Strategic Recommendation",
          value: strategy,
          isCurrency: false,
        },
      ];
    },
  },
};
