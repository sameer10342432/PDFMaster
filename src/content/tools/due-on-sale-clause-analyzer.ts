import { CalculatorContent } from '@/types';

export const DUE_ON_SALE_CLAUSE_ANALYZER_CONTENT: CalculatorContent = {
  title: 'Due on Sale Clause Analyzer',
  description: 'Analyze due-on-sale clause implications and creative financing strategies',
  icon: 'Icon',
  category: 'Legal & Compliance',
  slug: 'due-on-sale-clause-analyzer',
  article: {
    title: "Understanding Due-on-Sale Clauses and How They Work",
    content: `
    <h2>What is a Due-on-Sale Clause?</h2>
    <p>A due-on-sale clause (also called an "alienation clause") is a provision in a mortgage that allows the lender to demand full repayment of the loan if the property is sold or transferred to a new owner.</p>
    
    <h3>How Due-on-Sale Clauses Work</h3>
    <p>When you sell your property:</p>
    <ul>
      <li><strong>Traditional Sale:</strong> Buyer gets new loan, your loan is paid off at closing</li>
      <li><strong>With Due-on-Sale Clause:</strong> Lender can demand immediate full payment if property transfers</li>
      <li><strong>Purpose:</strong> Protects lender's interest and prevents unauthorized loan assumptions</li>
      <li><strong>Enforcement:</strong> Lender's discretion - may or may not enforce</li>
    </ul>
    
    <h3>Exemptions to Due-on-Sale (Garn-St. Germain Act)</h3>
    <p>Federal law protects certain transfers from due-on-sale enforcement:</p>
    <ul>
      <li><strong>Divorce Transfer:</strong> Transfer to spouse or ex-spouse in divorce decree</li>
      <li><strong>Death Transfer:</strong> Transfer to heir upon borrower's death</li>
      <li><strong>Living Trust:</strong> Transfer into revocable living trust (borrower is beneficiary)</li>
      <li><strong>Spouse Transfer:</strong> Adding or removing spouse to/from title</li>
      <li><strong>Relative Transfer:</strong> Transfer to relative who will occupy property</li>
      <li><strong>Leasehold Transfer:</strong> Lease of less than 3 years with no purchase option</li>
      <li><strong>Family Transfer:</strong> Parent to child or child to parent (if they occupy)</li>
    </ul>
    
    <h3>Creative Financing Strategies</h3>
    <p><strong>Subject-To Financing:</strong></p>
    <ul>
      <li>Buyer takes title "subject to" existing mortgage</li>
      <li>Seller's loan remains in place</li>
      <li>Buyer makes payments but doesn't assume liability</li>
      <li>Risk: Lender may call loan if discovered</li>
      <li>Strategy: Keep insurance, payments current to avoid detection</li>
    </ul>
    
    <p><strong>Wrap-Around Mortgage:</strong></p>
    <ul>
      <li>Seller finances purchase price minus existing loan</li>
      <li>Buyer makes one payment to seller</li>
      <li>Seller continues paying original mortgage</li>
      <li>Creates seller financing opportunity</li>
    </ul>
    
    <p><strong>Land Contract (Contract for Deed):</strong></p>
    <ul>
      <li>Seller retains title until fully paid</li>
      <li>Buyer has equitable interest and possession</li>
      <li>May not trigger due-on-sale (debatable)</li>
      <li>State-specific laws apply</li>
    </ul>
    
    <h3>Risk Factors for Triggering Due-on-Sale</h3>
    <ul>
      <li><strong>Insurance Changes:</strong> New buyer changes insurance policy</li>
      <li><strong>Tax Changes:</strong> Property tax bills show new owner</li>
      <li><strong>Title Changes:</strong> Deed recorded with new owner</li>
      <li><strong>Payment Defaults:</strong> Missed payments attract lender attention</li>
      <li><strong>Refinance Attempts:</strong> Buyer tries to refinance</li>
      <li><strong>Lender Monitoring:</strong> Some lenders actively monitor transfers</li>
    </ul>
    
    <h3>When Lenders Enforce Due-on-Sale</h3>
    <ul>
      <li><strong>Rising Interest Rates:</strong> Lender wants higher rate on new loan</li>
      <li><strong>Payment Issues:</strong> New owner misses payments</li>
      <li><strong>Property Deterioration:</strong> New owner not maintaining property</li>
      <li><strong>Policy Changes:</strong> Lender changes enforcement policy</li>
      <li><strong>Loan Sale:</strong> Original lender sells loan to new servicer</li>
    </ul>
    
    <h3>Consequences of Triggering Due-on-Sale</h3>
    <ul>
      <li><strong>Acceleration:</strong> Full loan balance becomes immediately due</li>
      <li><strong>Default Notice:</strong> Lender sends notice of default</li>
      <li><strong>Foreclosure Threat:</strong> Non-payment leads to foreclosure proceedings</li>
      <li><strong>Options:</strong> Pay off loan, refinance, negotiate with lender</li>
      <li><strong>Timeline:</strong> Typically 30-90 days to cure or pay off</li>
    </ul>
    
    <h3>Mitigating Due-on-Sale Risk</h3>
    <ul>
      <li><strong>Keep Current:</strong> Never miss a payment - attracts attention</li>
      <li><strong>Insurance Continuity:</strong> Maintain original insurance or add buyer as additional insured</li>
      <li><strong>Communication:</strong> Some investors notify lender proactively</li>
      <li><strong>Reserved Rights:</strong> Document seller's right to pay if needed</li>
      <li><strong>Exit Strategy:</strong> Plan to refinance within 1-3 years</li>
      <li><strong>Legal Review:</strong> Have attorney structure transaction properly</li>
    </ul>
    
    <h3>When to Use Subject-To Strategy</h3>
    <p><strong>Good Situations:</strong></p>
    <ul>
      <li>Seller motivated (foreclosure, divorce, relocation)</li>
      <li>Low interest rate worth preserving</li>
      <li>Buyer can't qualify for traditional financing</li>
      <li>Property needs quick sale</li>
      <li>Seller has equity to protect</li>
    </ul>
    
    <p><strong>Bad Situations:</strong></p>
    <ul>
      <li>High interest rate on existing loan</li>
      <li>Large loan balance near property value</li>
      <li>Buyer plans long-term hold without refinancing</li>
      <li>Seller unwilling to accept risk</li>
      <li>Property in poor condition</li>
    </ul>
    
    <h3>Legal Considerations</h3>
    <ul>
      <li><strong>Disclosure:</strong> Some states require disclosure of due-on-sale risk</li>
      <li><strong>Attorney Advice:</strong> Essential for creative financing structures</li>
      <li><strong>Insurance Issues:</strong> Title insurance may not cover due-on-sale enforcement</li>
      <li><strong>Fraud Concerns:</strong> Misrepresentation to lender can be mortgage fraud</li>
      <li><strong>State Laws:</strong> Vary significantly on enforcement and remedies</li>
    </ul>
    
    <h3>Alternative Strategies</h3>
    <ul>
      <li><strong>Loan Assumption:</strong> Formal assumption (if loan is assumable)</li>
      <li><strong>Seller Financing:</strong> Seller provides second mortgage</li>
      <li><strong>Lease Option:</strong> Lease with option to purchase later</li>
      <li><strong>Partnership:</strong> Form entity with seller retaining interest</li>
      <li><strong>Traditional Purchase:</strong> Get new financing and pay off existing loan</li>
    </ul>
  `,
  },
  calculator: {
    fields: [
      {
        name: "existingLoanBalance",
        label: "Existing Loan Balance",
        type: "number",
        placeholder: "250000",
        defaultValue: "250000",
      },
      {
        name: "existingInterestRate",
        label: "Existing Interest Rate (%)",
        type: "number",
        placeholder: "3.5",
        defaultValue: "3.5",
      },
      {
        name: "currentMarketRate",
        label: "Current Market Rate (%)",
        type: "number",
        placeholder: "6.5",
        defaultValue: "6.5",
      },
      {
        name: "propertyValue",
        label: "Property Value",
        type: "number",
        placeholder: "300000",
        defaultValue: "300000",
      },
      {
        name: "transferType",
        label: "Type of Transfer",
        type: "select",
        options: [
          "Sale to Unrelated Buyer",
          "Divorce Transfer to Spouse",
          "Death - Inheritance",
          "Transfer to Living Trust",
          "Transfer to Child/Parent (Occupant)",
          "Lease (No Purchase Option)",
          "Subject-To Purchase"
        ],
        defaultValue: "Sale to Unrelated Buyer",
      },
      {
        name: "lenderType",
        label: "Lender Type",
        type: "select",
        options: [
          "Large Bank (Chase, Wells Fargo, etc.)",
          "Credit Union",
          "Local/Regional Bank",
          "Non-Bank Lender",
          "Government Loan (FHA/VA)"
        ],
        defaultValue: "Large Bank (Chase, Wells Fargo, etc.)",
      },
    ],
    results: [
      { label: "Protected Transfer?", isCurrency: false },
      { label: "Enforcement Risk", isCurrency: false },
      { label: "Rate Advantage", isCurrency: false },
      { label: "Monthly Payment Difference", isCurrency: true },
      { label: "Recommendation", isCurrency: false },
    ],
    calculate: (data: any) => {
      const existingLoanBalance = Number(data.existingLoanBalance) || 0;
      const existingInterestRate = Number(data.existingInterestRate) || 0;
      const currentMarketRate = Number(data.currentMarketRate) || 0;
      const propertyValue = Number(data.propertyValue) || 0;
      const transferType = data.transferType || "Sale to Unrelated Buyer";
      const lenderType = data.lenderType || "Large Bank (Chase, Wells Fargo, etc.)";
      
      // Determine if protected under Garn-St. Germain
      let isProtected = false;
      let protectedText = "";
      
      if (transferType.includes("Divorce") || 
          transferType.includes("Death") || 
          transferType.includes("Living Trust") ||
          transferType.includes("Child/Parent") ||
          transferType.includes("Lease")) {
        isProtected = true;
        protectedText = "âœ… YES - Protected by Federal Law";
      } else {
        protectedText = "âŒ NO - Subject to Lender Discretion";
      }
      
      // Calculate enforcement risk
      let enforcementRisk = "";
      let riskPoints = 0;
      
      // Interest rate risk
      const rateDifference = currentMarketRate - existingInterestRate;
      if (rateDifference >= 3) riskPoints += 3;
      else if (rateDifference >= 2) riskPoints += 2;
      else if (rateDifference >= 1) riskPoints += 1;
      
      // Lender type risk
      if (lenderType.includes("Large Bank")) {
        riskPoints += 2; // More likely to enforce
      } else if (lenderType.includes("Non-Bank")) {
        riskPoints += 1;
      } else if (lenderType.includes("Credit Union")) {
        riskPoints += 1;
      }
      
      // Transfer type risk
      if (transferType === "Subject-To Purchase") {
        riskPoints += 2;
      } else if (transferType === "Sale to Unrelated Buyer") {
        riskPoints += 3;
      }
      
      // Protected transfers have no risk
      if (isProtected) {
        enforcementRisk = "ðŸŸ¢ NO RISK - Protected Transfer";
      } else {
        if (riskPoints >= 6) {
          enforcementRisk = "ðŸ”´ HIGH RISK - Likely to Enforce";
        } else if (riskPoints >= 4) {
          enforcementRisk = "ðŸŸ  MODERATE RISK - May Enforce";
        } else {
          enforcementRisk = "ðŸŸ¡ LOW-MODERATE RISK - Less Likely";
        }
      }
      
      // Calculate rate advantage
      const rateAdvantage = rateDifference > 0 
        ? `${rateDifference.toFixed(2)}% lower than market`
        : `${Math.abs(rateDifference).toFixed(2)}% higher than market`;
      
      // Calculate monthly payment difference (rough estimate)
      const monthlyOldRate = (existingLoanBalance * (existingInterestRate / 100 / 12));
      const monthlyNewRate = (existingLoanBalance * (currentMarketRate / 100 / 12));
      const monthlyDifference = monthlyNewRate - monthlyOldRate;
      
      // Recommendation
      let recommendation = "";
      
      if (isProtected) {
        recommendation = "SAFE TO PROCEED: This transfer is protected by federal law (Garn-St. Germain Act). The lender cannot enforce the due-on-sale clause. Complete the transfer normally.";
      } else if (transferType === "Subject-To Purchase") {
        if (riskPoints >= 6) {
          recommendation = "HIGH RISK: Rate difference makes enforcement very likely. Consider: (1) Negotiate assumable loan with lender, (2) Traditional refinance, (3) Seller carry-back financing. Subject-to is risky here.";
        } else if (riskPoints >= 4) {
          recommendation = "MODERATE RISK but worth considering. Strategies: (1) Keep payments current always, (2) Maintain original insurance, (3) Plan to refinance in 1-2 years, (4) Have attorney structure properly, (5) Build reserves for quick payoff if needed.";
        } else {
          recommendation = "MANAGEABLE RISK: Subject-to may work. Best practices: (1) Never miss payments, (2) Keep low profile (maintain insurance/taxes), (3) Refinance when possible, (4) Build relationship with lender, (5) Have backup exit strategy.";
        }
      } else {
        if (riskPoints >= 6) {
          recommendation = "EXPECT ENFORCEMENT: Given the rate environment and lender type, due-on-sale will likely be called. Options: (1) Pay off at closing, (2) Buyer gets new financing, (3) Negotiate assumption if allowed.";
        } else {
          recommendation = "STANDARD TRANSACTION: While clause exists, enforcement is uncertain. Traditional path recommended: (1) Buyer obtains new financing, (2) Existing loan paid off at closing, (3) Clean title transfer. This is safest approach.";
        }
      }

      return [
        { label: "Protected Transfer?", value: protectedText, isCurrency: false },
        { label: "Enforcement Risk", value: enforcementRisk, isCurrency: false },
        { label: "Rate Advantage", value: rateAdvantage, isCurrency: false },
        { label: "Monthly Payment Difference", value: monthlyDifference.toFixed(2), isCurrency: true },
        { label: "Recommendation", value: recommendation, isCurrency: false },
      ];
    },
  },
};
