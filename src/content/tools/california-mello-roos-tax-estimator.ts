import { CalculatorContent } from "@/types";

export const CALIFORNIA_MELLO_ROOS_TAX_ESTIMATOR_CONTENT: CalculatorContent = {
  title: "California Mello-Roos Tax Estimator - Special Assessment Calculator",
  description: "Calculate Mello-Roos special taxes and Community Facilities District (CFD) assessments for California properties to understand your total annual property tax burden.",
  icon: "Icon",
  category: "Tax Calculators",
  slug: "california-mello-roos-tax-estimator",
  metaTitle: "California Mello-Roos Tax Calculator | CFD Assessment Estimator",
  metaDescription: "Estimate Mello-Roos special taxes for California properties. Calculate Community Facilities District assessments, bond payments, and total property tax costs.",
  article: {
    title: "California Mello-Roos Tax Estimator: Understanding Special Assessments",
    content: `
Buying a home in California? You may encounter Mello-Roos taxes—special assessments that can add hundreds or even thousands of dollars to your annual property tax bill. Unlike regular property taxes, Mello-Roos fees are often not deductible and can significantly impact affordability. This calculator helps you understand and estimate these hidden costs.

## What is Mello-Roos?

Mello-Roos is a special tax levied on property owners within Community Facilities Districts (CFDs) in California. Authorized by the Mello-Roos Community Facilities Act of 1982, these taxes fund infrastructure and services in new developments.

### Why Mello-Roos Exists

Before 1978, California cities funded infrastructure (schools, roads, sewers) through property taxes. Proposition 13 (1978) capped property tax rates at 1% of assessed value, severely limiting cities' ability to fund new development infrastructure.

**Solution:** Mello-Roos allows developers and cities to create Community Facilities Districts that levy special taxes on property owners to pay for infrastructure bonds.

## What Mello-Roos Funds

### Infrastructure (Typical Use)
✅ Streets, traffic signals, streetlights
✅ Water, sewer, and drainage systems
✅ Parks, recreation facilities, open space
✅ Fire stations and equipment
✅ Libraries and community centers
✅ Schools and school facilities

### Services (Less Common)
✅ Police and fire protection
✅ Paramedic services
✅ Park maintenance
✅ Landscaping maintenance in common areas

### NOT Funded by Mello-Roos
❌ Home maintenance
❌ Private HOA amenities (pools, clubhouses)
❌ Ongoing school operations (separate bond measures)

## How Mello-Roos Taxes Work

### Tax Amount Determination

**Two Common Methods:**

**1. Square Footage Based (Most Common)**
- Tax based on home size ($/sq ft)
- Example: $0.50/sq ft = $1,000/year for 2,000 sq ft home
- Increases annually (typically 2-3%)

**2. Flat Rate Per Parcel**
- Fixed amount per property regardless of size
- Example: $1,500/year per home
- Increases annually based on formula

### Annual Escalation
- Most Mello-Roos taxes increase annually
- Typical: 2% per year (inflation-adjusted)
- Some: Up to maximum allowed increase (2-5%)
- Continues until bonds are paid off

### Duration
**Bond-Funded CFDs (Most Common):**
- Typically 20-40 years from issuance
- Ends when infrastructure bonds are repaid
- Cannot be paid off early by individual homeowners

**Ongoing Service CFDs (Rare):**
- No set end date
- Continues as long as services are needed

## How Much is Mello-Roos?

### Typical Ranges
**Low:** $500-$1,000/year
**Medium:** $1,000-$3,000/year
**High:** $3,000-$8,000/year
**Very High:** $8,000-$15,000+/year (rare, master-planned communities)

### Factors Affecting Amount

**1. Development Cost**
- More expensive infrastructure = higher Mello-Roos
- Remote locations need more infrastructure
- Master-planned communities = higher costs

**2. Number of Homes**
- Costs divided among all properties in CFD
- Fewer homes = higher per-home cost
- Phased developments may have unequal burdens

**3. Home Size**
- Larger homes typically pay more (if sq ft-based)
- Disproportionate impact on large homes

**4. Age of Development**
- Newer developments (2000s-2020s) more likely
- Older neighborhoods unlikely to have Mello-Roos

### Geographic Concentration

**High Mello-Roos Areas:**
- Inland Empire (Riverside, San Bernardino counties)
- Central Valley (Fresno, Kern, Stanislaus counties)
- Outlying suburbs of major metros
- Master-planned communities
- New developments (post-2000)

**Low/No Mello-Roos Areas:**
- Established coastal cities
- Pre-1980s neighborhoods
- Infill developments
- Built-out cities with existing infrastructure

## Tax Deductibility Issues

### Federal Tax Treatment

**Before 2018 (TCJA):**
- Mello-Roos was NOT deductible (special assessment, not property tax)
- Regular property taxes were deductible (no limit)

**After 2018 (TCJA - Current):**
- Mello-Roos still NOT deductible in most cases
- Regular property taxes deductible up to $10,000 (SALT cap)
- This limit includes state income tax + property tax

**Exception:**
- If Mello-Roos funds ongoing services (not bond repayment), MAY be deductible
- Consult tax professional for specific CFD

### Impact on Effective Tax Rate

**Example Property:**
- Purchase Price: $500,000
- Base Property Tax (1%): $5,000/year
- Mello-Roos: $3,000/year
- Total Tax: $8,000/year
- **Effective Tax Rate: 1.6%** (vs. California's "1%" claim)

## How to Find Mello-Roos Information

### Before Purchase

**1. Seller's Disclosure**
- Required in California real estate transactions
- Should list all special taxes
- Review Natural Hazard Disclosure Report

**2. County Tax Assessor Website**
- Search by property address
- View itemized tax bill
- Look for "special assessments" or "CFD"

**3. Title Report**
- Preliminary title report shows all liens
- CFDs listed as exceptions to title
- Request before making offer

**4. HOA Documents**
- CC&Rs should mention Mello-Roos if applicable
- May include payment history

**5. Ask Your Agent**
- Local agents familiar with CFD areas
- Can identify Mello-Roos communities

### Online Resources
- **California Municipal Bonds:** Check active CFDs
- **County Treasurer-Tax Collector:** Annual tax bills
- **Property Tax Portal:** Many counties have online lookup

## Impact on Homeownership Costs

### Monthly Payment Impact

**Example: $500,000 Home**

**Without Mello-Roos:**
- Mortgage (20% down, 7%): $2,661/month
- Property tax (1%): $417/month
- Insurance: $150/month
- **Total: $3,228/month**

**With $3,600/year Mello-Roos:**
- Mortgage: $2,661/month
- Property tax (1%): $417/month
- Mello-Roos: $300/month
- Insurance: $150/month
- **Total: $3,528/month** (+$300/month)

**Impact:** 9% increase in monthly housing cost

### Qualification Impact

**Debt-to-Income Ratio:**
- Lenders include Mello-Roos in DTI calculations
- Can reduce maximum loan amount
- May disqualify buyers at higher price points

**Example:**
- Income: $100,000/year = $8,333/month
- Maximum DTI: 43% = $3,583/month
- Without Mello-Roos: Qualify for $550,000 home
- With $300/month Mello-Roos: Qualify for $500,000 home
- **Reduction: $50,000 in buying power**

### Resale Impact

**Challenges:**
- Homes with high Mello-Roos are harder to sell
- Smaller buyer pool (many avoid Mello-Roos)
- Price resistance (buyers factor in ongoing cost)
- Appraisal issues (comp selection)

**Offsetting Factors:**
- Newer infrastructure (schools, parks, roads)
- Lower maintenance needs
- Planned communities with amenities

## Strategies for Mello-Roos Properties

### Strategy 1: Factor Into Purchase Price
- Negotiate lower price to offset Mello-Roos
- Calculate present value of Mello-Roos over 30 years
- Use as negotiation leverage

**Example:**
- Mello-Roos: $3,000/year for 25 years
- Present value (6% discount): ~$38,500
- Negotiate: $35,000-$40,000 lower purchase price

### Strategy 2: Shorter-Term Ownership
- If planning to move in 5-10 years, Mello-Roos impact is limited
- Total cost: 5 years × $3,000 = $15,000 (more manageable)

### Strategy 3: Compare to Alternatives
- Compare Mello-Roos home to similar non-Mello-Roos home
- If price difference > present value of Mello-Roos, may still be good deal
- Consider quality of schools, amenities, location

### Strategy 4: Higher Down Payment
- Offset higher monthly cost with lower mortgage
- Reduce DTI to qualify despite Mello-Roos

### Strategy 5: Verify End Date
- Check when Mello-Roos expires
- Properties with 5-10 years remaining less burdensome
- If expires during ownership, significant benefit

## Avoiding Mello-Roos

### Target Older Neighborhoods
- Pre-1980s developments unlikely to have Mello-Roos
- Established infrastructure already paid off
- Mature trees, amenities

### Choose Infill Developments
- New construction in built-out areas
- Existing infrastructure = no Mello-Roos
- Often better location vs. outlying areas

### Research Before Searching
- Identify Mello-Roos-free cities/neighborhoods
- Focus search on low-tax areas
- Work with agent familiar with local CFDs

### Understand Trade-Offs
- No Mello-Roos may mean:
  - Older infrastructure
  - Longer commute (coastal vs. inland)
  - Higher purchase price
  - Less modern floor plans

## Other California Special Taxes

### Similar Assessments

**1. Community Facilities District (CFD)**
- Synonym for Mello-Roos in many cases
- Same purpose and structure

**2. Special Assessment Districts**
- Similar to Mello-Roos
- Local improvements (streetlights, sidewalks)
- Typically smaller amounts ($100-$500/year)

**3. Supplemental Taxes**
- One-time tax when property changes hands
- Based on difference between old and new assessed value
- Due within months of purchase

**4. Land-Based Assessments**
- Lighting and landscape districts
- Storm drain assessments
- Usually minor ($50-$200/year)

## Real-World Examples

### Example 1: Riverside County New Development
**Home:** $450,000, 2,200 sq ft
**Mello-Roos:** $0.70/sq ft = $1,540/year
**Duration:** 30 years remaining
**Annual Increase:** 2%
**30-Year Total:** $62,000
**Monthly Cost:** $128 (year 1), $233 (year 30)

### Example 2: Fresno Master-Planned Community
**Home:** $380,000, 1,800 sq ft
**Mello-Roos:** $2,800/year (flat rate)
**Duration:** 25 years remaining
**Annual Increase:** 2%
**25-Year Total:** $89,000
**Monthly Cost:** $233 (year 1), $382 (year 25)

### Example 3: San Diego Outlying Suburb
**Home:** $650,000, 2,500 sq ft
**Mello-Roos:** $4,200/year
**Duration:** 35 years remaining
**Annual Increase:** 2%
**Impact:** +$350/month housing cost
**Reduces buying power:** ~$50,000

## Using This Calculator

### Step 1: Gather Information
- Request property tax bill from seller/agent
- Check county assessor website
- Review title report and disclosures

### Step 2: Input Data
- Current annual Mello-Roos amount
- Annual increase rate (check CFD documents)
- Years remaining on bond
- Your planned ownership duration

### Step 3: Analyze Results
- Total Mello-Roos over ownership period
- Monthly impact on housing costs
- Present value (for price negotiation)
- Compare to alternative properties

### Step 4: Make Informed Decision
- Factor into purchase offer
- Calculate true monthly cost of ownership
- Determine if trade-offs are worth it

## Conclusion

Mello-Roos taxes can add $1,000-$5,000+ annually to your property tax bill—costs that often surprise unsuspecting California homebuyers. These special assessments fund infrastructure in newer developments but are typically not tax-deductible and can last 20-40 years.

Before purchasing a Mello-Roos property:
1. Get exact Mello-Roos amount and duration
2. Calculate total cost over ownership period
3. Factor into affordability and DTI calculations
4. Negotiate purchase price to offset burden
5. Compare to non-Mello-Roos alternatives

Use this calculator to understand the true long-term cost of Mello-Roos and make informed decisions about California home purchases.

### Next Steps
1. Check if target properties have Mello-Roos (county tax website)
2. Request seller's property tax bill
3. Calculate present value of Mello-Roos burden
4. Factor into home budget and qualification
5. Negotiate purchase price if Mello-Roos is substantial
6. Consult with local real estate agent and tax professional

California homeownership is expensive enough—don't let hidden Mello-Roos taxes catch you by surprise. Know before you buy.
    `,
  },
  calculator: {
    fields: [
      { name: "homeValue", label: "Home Purchase Price ($)", type: "number", defaultValue: "500000" },
      { name: "homeSquareFeet", label: "Home Square Footage", type: "number", defaultValue: "2000" },
      { name: "currentMelloRoos", label: "Current Annual Mello-Roos Tax ($)", type: "number", defaultValue: "2500" },
      { name: "annualIncrease", label: "Annual Increase Rate (%)", type: "number", defaultValue: "2" },
      { name: "yearsRemaining", label: "Years Remaining on Bond", type: "number", defaultValue: "25" },
      { name: "plannedOwnership", label: "Your Planned Ownership (Years)", type: "number", defaultValue: "10" },
      { name: "basePropertyTaxRate", label: "Base Property Tax Rate (%)", type: "number", defaultValue: "1.0" },
      { name: "discountRate", label: "Discount Rate for PV Calculation (%)", type: "number", defaultValue: "6" },
    ],
    results: [
      { label: "Annual Base Property Tax", isCurrency: true },
      { label: "First Year Total Tax (Base + Mello-Roos)", isCurrency: true },
      { label: "Effective Tax Rate (Year 1)", isCurrency: false },
      { label: "Total Mello-Roos Over Ownership", isCurrency: true },
      { label: "Average Annual Mello-Roos", isCurrency: true },
      { label: "Average Monthly Mello-Roos", isCurrency: true },
      { label: "Present Value of Mello-Roos Burden", isCurrency: true },
      { label: "Final Year Mello-Roos Amount", isCurrency: true },
    ],
    calculate: (values) => {
      const basePropertyTax = values.homeValue * (values.basePropertyTaxRate / 100);
      const firstYearTotalTax = basePropertyTax + values.currentMelloRoos;
      const effectiveTaxRate = (firstYearTotalTax / values.homeValue) * 100;
      
      const ownershipYears = Math.min(values.plannedOwnership, values.yearsRemaining);
      let totalMelloRoos = 0;
      let presentValue = 0;
      let currentAmount = values.currentMelloRoos;
      const growthRate = values.annualIncrease / 100;
      const discountRate = values.discountRate / 100;
      
      for (let year = 1; year <= ownershipYears; year++) {
        totalMelloRoos += currentAmount;
        presentValue += currentAmount / Math.pow(1 + discountRate, year);
        currentAmount *= (1 + growthRate);
      }
      
      const finalYearAmount = values.currentMelloRoos * Math.pow(1 + growthRate, ownershipYears);
      const averageAnnual = totalMelloRoos / ownershipYears;
      const averageMonthly = averageAnnual / 12;

      return [
        { label: "Annual Base Property Tax", value: basePropertyTax.toFixed(2), isCurrency: true },
        { label: "First Year Total Tax (Base + Mello-Roos)", value: firstYearTotalTax.toFixed(2), isCurrency: true },
        { label: "Effective Tax Rate (Year 1)", value: effectiveTaxRate.toFixed(3) + '%', isCurrency: false },
        { label: "Total Mello-Roos Over Ownership", value: totalMelloRoos.toFixed(2), isCurrency: true },
        { label: "Average Annual Mello-Roos", value: averageAnnual.toFixed(2), isCurrency: true },
        { label: "Average Monthly Mello-Roos", value: averageMonthly.toFixed(2), isCurrency: true },
        { label: "Present Value of Mello-Roos Burden", value: presentValue.toFixed(2), isCurrency: true },
        { label: "Final Year Mello-Roos Amount", value: finalYearAmount.toFixed(2), isCurrency: true },
      ];
    },
  },
};
