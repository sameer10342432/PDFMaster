import { CalculatorContent } from '@/types';

export const CAR_WASH_BUSINESS_ROI_CALCULATOR_CONTENT: CalculatorContent = {
  title: 'Car Wash Business ROI Calculator',
  description: 'Analyze investment returns for car wash businesses including self-serve, automatic, express, and full-service facilities.',
  slug: 'car-wash-business-roi-calculator',
  icon: 'ðŸš—',
  category: 'Investment Analysis',
  article: {
    title: 'Complete Guide to Car Wash Business Investment Returns',
    content: `
    <h2>Understanding Car Wash Business Investments</h2>
    <p>Car wash businesses represent one of the most resilient and profitable segments in the service industry, offering recession-resistant cash flow and strong unit economics. With over 275 million registered vehicles in the United States and consumers increasingly valuing vehicle maintenance, the car wash industry generates over $15 billion annually and continues to grow. This calculator helps investors analyze returns across different car wash formats including self-serve, automatic, express exterior, and full-service facilities.</p>
    
    <h3>Types of Car Wash Businesses</h3>
    <p>The car wash industry encompasses several distinct business models, each with unique operational characteristics and revenue potential:</p>
    <ul>
      <li><strong>Self-Serve Car Wash:</strong> Bay-style facilities where customers wash their own vehicles using coin-operated or card-activated equipment. Lower labor costs but also lower revenue per wash. Typically 4-8 bays with high-pressure wash systems, foam brushes, and vacuum stations.</li>
      <li><strong>In-Bay Automatic (IBA):</strong> Single or multiple bay facilities with automated wash systems where the vehicle remains stationary while equipment moves around it. Moderate capital investment with good ROI potential. Minimal labor required.</li>
      <li><strong>Tunnel/Conveyor Car Wash:</strong> Automated tunnel systems where vehicles are pulled through on a conveyor belt. High throughput capacity (100-200+ cars per day). Significant capital investment but highest revenue potential. Often includes express exterior and full-service options.</li>
      <li><strong>Express Exterior:</strong> Fast, exterior-only tunnel washes focused on volume and speed (3-5 minute wash cycles). Popular membership/subscription model. Free vacuums typically included. Fastest growing segment of the industry.</li>
      <li><strong>Full-Service Car Wash:</strong> Comprehensive cleaning including exterior wash, interior detailing, and hand-drying services. Premium pricing with labor-intensive operations. May include detailing services for additional revenue.</li>
      <li><strong>Flex-Serve:</strong> Hybrid model combining express exterior tunnel with optional interior cleaning services. Customers choose service level, maximizing revenue per customer while maintaining efficiency.</li>
    </ul>

    <h3>Key Investment Metrics for Car Wash Businesses</h3>
    <p>Car wash businesses are evaluated using specialized metrics that reflect their unique operational dynamics:</p>
    <ul>
      <li><strong>Cars Per Day (CPD):</strong> Average number of vehicles washed daily. Critical volume metric that drives revenue. Varies significantly by format, location, and season.</li>
      <li><strong>Average Ticket Price:</strong> Average revenue per wash including base wash price and upgrades. Heavily influenced by local market pricing and service level.</li>
      <li><strong>Monthly Wash Volume:</strong> Total cars washed per month (CPD Ã— operating days). Accounts for seasonality and weather variations.</li>
      <li><strong>Membership Penetration:</strong> Percentage of revenue from unlimited wash memberships versus retail washes. Higher penetration creates more predictable, recurring revenue.</li>
      <li><strong>Labor Ratio:</strong> Labor costs as percentage of revenue. Ranges from 10-15% for express/automatic to 35-45% for full-service operations.</li>
      <li><strong>EBITDA Margin:</strong> Earnings before interest, taxes, depreciation, and amortization as percentage of revenue. Well-operated sites achieve 35-50% EBITDA margins.</li>
    </ul>

    <h3>Revenue Drivers in Car Wash Operations</h3>
    <p>Car wash businesses generate revenue through multiple streams, creating opportunities for revenue optimization:</p>
    <ul>
      <li><strong>Retail Wash Sales:</strong> Single-visit wash revenue at posted menu prices. Foundation of revenue but subject to weather and seasonality fluctuations.</li>
      <li><strong>Unlimited Membership Programs:</strong> Subscription-based monthly memberships allowing unlimited washes. Creates recurring revenue, reduces weather sensitivity, and increases customer lifetime value. Typical plans range from $19.99-$49.99/month.</li>
      <li><strong>Wash Package Upgrades:</strong> Tiered service levels (basic, deluxe, premium, ultimate) with incremental features like tire shine, wheel cleaning, triple foam, ceramic coating, undercarriage wash. Upselling increases average ticket by 30-60%.</li>
      <li><strong>Interior Services:</strong> Vacuuming, window cleaning, dashboard treatment, upholstery cleaning offered as add-ons or standalone services.</li>
      <li><strong>Detailing Services:</strong> Full interior detailing, paint correction, ceramic coating, headlight restoration. High-margin services generating $100-$500+ per service.</li>
      <li><strong>Ancillary Products:</strong> Vending machines (air fresheners, cleaning supplies), mat cleaning systems, pet wash stations, and convenience items.</li>
      <li><strong>Fleet Contracts:</strong> Commercial accounts with taxi companies, rental agencies, dealerships, and delivery services providing consistent volume.</li>
    </ul>

    <h3>Operating Expense Categories</h3>
    <p>Understanding the cost structure of car wash operations is critical for accurate financial projections:</p>
    <ul>
      <li><strong>Labor Costs (10-45% of revenue):</strong> Varies dramatically by format. Express exterior: 10-15%, Full-service: 35-45%. Includes wash attendants, customer service, maintenance staff, and management. Membership models can reduce labor per car.</li>
      <li><strong>Chemical and Supply Costs (3-6% of revenue):</strong> Soap, wax, drying agents, tire shine, and other consumables. Volume discounts available through supplier relationships. Cost per car typically $0.50-$1.50.</li>
      <li><strong>Utilities (4-8% of revenue):</strong> Water, electricity, natural gas (for dryers and heaters), and sewer. Water reclamation systems can reduce water costs by 50-80%. LED lighting and efficient equipment lower electricity consumption.</li>
      <li><strong>Equipment Maintenance (4-7% of revenue):</strong> Regular maintenance, repairs, and replacement parts for wash systems, conveyors, dryers, and payment systems. Preventive maintenance critical to minimize downtime.</li>
      <li><strong>Credit Card Processing (2-3% of revenue):</strong> Merchant fees for credit/debit transactions. Higher percentage of revenue than most businesses due to low average transaction size.</li>
      <li><strong>Property Expenses (5-10% of revenue):</strong> Property taxes, insurance (general liability, property, workers' comp), rent or lease payments. Location quality drives property costs.</li>
      <li><strong>Marketing (3-6% of revenue):</strong> Advertising, promotions, membership acquisition costs, signage, digital marketing, and loyalty programs. Higher during launch phase and competitive markets.</li>
      <li><strong>Capital Reserve for Equipment:</strong> Reserve fund for major equipment replacement and facility upgrades. Tunnel equipment may need replacement every 15-20 years at significant cost.</li>
    </ul>

    <h3>Location Factors and Site Selection</h3>
    <p>Location is the single most important factor in car wash success. Critical site selection criteria include:</p>
    <ul>
      <li><strong>Traffic Count:</strong> Minimum 20,000-30,000 vehicles per day on adjacent roadway for new builds. Higher traffic correlates with higher visibility and customer volume.</li>
      <li><strong>Demographics:</strong> Household income $50,000+ within 3-mile radius. Population density of 10,000+ residents per square mile ideal. Car ownership rates and commuting patterns matter.</li>
      <li><strong>Accessibility and Visibility:</strong> Easy ingress/egress, visible from main road, on "going home" side of traffic (right side for most commuters). Corner locations premium but more expensive.</li>
      <li><strong>Competition Analysis:</strong> Evaluate number, type, and quality of competing car washes within 3-5 mile radius. Oversaturated markets reduce pricing power and volume.</li>
      <li><strong>Land Requirements:</strong> Self-serve: 0.5-1 acre, In-bay automatic: 0.5-0.75 acre, Express tunnel: 1-2 acres, Full-service: 1.5-3 acres. Need adequate queuing space and stacking lanes.</li>
      <li><strong>Zoning and Permits:</strong> Confirm zoning allows car wash use. Water discharge permits, environmental compliance, and building permits can be complex and time-consuming.</li>
    </ul>

    <h3>Equipment Costs and Capital Investment</h3>
    <p>Car wash businesses are capital-intensive with significant upfront equipment costs:</p>
    <ul>
      <li><strong>Self-Serve Equipment:</strong> $30,000-$75,000 per bay including high-pressure pumps, hose reels, coin/card systems, and chemical dispensers. Total facility: $150,000-$400,000.</li>
      <li><strong>In-Bay Automatic:</strong> $100,000-$250,000 per bay for touchless or soft-touch equipment. Multiple bays increase efficiency and revenue capacity.</li>
      <li><strong>Express Tunnel Equipment:</strong> $500,000-$1,500,000 for complete tunnel system including conveyor, dryers, arches, and control systems. Manufacturer choice impacts reliability and maintenance costs.</li>
      <li><strong>Full-Service Tunnel:</strong> $750,000-$2,500,000+ including extended tunnel, premium drying system, and interior cleaning areas. Luxury finishes and customer amenities add cost.</li>
      <li><strong>Water Reclamation Systems:</strong> $75,000-$200,000 for reclaim system that recycles 50-85% of water. ROI through reduced water/sewer costs and environmental compliance.</li>
      <li><strong>Point-of-Sale and Payment Systems:</strong> $15,000-$50,000 for modern POS, membership management software, license plate recognition (LPR), and payment terminals.</li>
      <li><strong>Vacuum Systems:</strong> $3,000-$8,000 per vacuum station. Express washes typically offer 8-16 free vacuum positions.</li>
    </ul>

    <h3>The Power of Membership Programs</h3>
    <p>Unlimited wash membership programs have transformed the car wash industry economics:</p>
    <ul>
      <li><strong>Recurring Revenue Model:</strong> Members pay monthly fee for unlimited washes, creating predictable revenue stream less affected by weather. Membership revenue can represent 60-80% of total revenue.</li>
      <li><strong>Increased Frequency:</strong> Members visit 3-4x per month versus 1-2x for retail customers, building loyalty and habit. Higher utilization drives volume efficiency.</li>
      <li><strong>Customer Lifetime Value:</strong> Average member retention 12-18 months. Lifetime value of $300-$900 per member versus $20-40 for retail customer.</li>
      <li><strong>Lower Customer Acquisition Cost:</strong> Word-of-mouth and member referrals reduce marketing costs over time.</li>
      <li><strong>Valuation Premium:</strong> Investors pay higher multiples (6-8x EBITDA) for membership-heavy operations versus retail-heavy (4-5x EBITDA) due to revenue predictability.</li>
      <li><strong>Technology Enablement:</strong> RFID tags or license plate recognition automate member identification. Mobile apps manage subscriptions and enhance customer experience.</li>
    </ul>

    <h3>How to Use This Calculator</h3>
    <p>This calculator helps you model car wash business investment returns. Input the following data:</p>
    <ul>
      <li><strong>Property Purchase Price:</strong> Total acquisition cost including land, building, equipment, and working capital. For new builds, include all development costs.</li>
      <li><strong>Monthly Car Count:</strong> Average number of vehicles washed per month. Research comparable facilities, adjust for ramp-up period and seasonality.</li>
      <li><strong>Average Ticket Price:</strong> Average revenue per wash including retail washes and membership equivalent value. Typical range: $8-$20 depending on format and market.</li>
      <li><strong>Labor Cost Percentage:</strong> Labor expenses as percentage of gross revenue (10-15% express, 20-30% automatic, 35-45% full-service).</li>
      <li><strong>Operating Expense Ratio:</strong> Total operating expenses as percentage of revenue. Well-run facilities: 50-65%. Include chemicals, utilities, maintenance, marketing, and overhead.</li>
      <li><strong>Monthly Membership Revenue:</strong> Recurring revenue from unlimited membership subscriptions. Separate from retail revenue to highlight recurring revenue base.</li>
      <li><strong>Equipment Reserve (%)</strong>: Annual reserve for equipment replacement as percentage of revenue (typically 3-5%). Critical for long-term sustainability.</li>
      <li><strong>Down Payment:</strong> Equity investment as percentage of purchase price. Lenders typically require 20-30% down for car wash financing.</li>
      <li><strong>Interest Rate:</strong> Annual loan interest rate. SBA loans: 7-9%, Conventional: 6-8%, Seller financing: varies widely.</li>
      <li><strong>Loan Term:</strong> Amortization period in years (typically 10-25 years for car wash loans).</li>
      <li><strong>Holding Period:</strong> Expected investment horizon before sale or refinance.</li>
      <li><strong>Exit Cap Rate:</strong> Expected capitalization rate at sale. Quality car washes trade at 5-8% cap rates depending on age, format, and market.</li>
    </ul>

    <h3>Key Performance Indicators</h3>
    <p>The calculator provides critical metrics for investment decision-making:</p>
    <ul>
      <li><strong>Gross Annual Revenue:</strong> Total revenue from all sources before any expenses. Foundation for all other metrics.</li>
      <li><strong>Net Operating Income (NOI):</strong> Revenue minus operating expenses before debt service. Key metric for valuation and operational performance.</li>
      <li><strong>Cash Flow After Debt Service:</strong> NOI minus mortgage payments. Actual cash available to investor for distributions or reinvestment.</li>
      <li><strong>Cash-on-Cash Return:</strong> Annual cash flow divided by initial equity investment. Target 15-25%+ for acceptable returns.</li>
      <li><strong>Capitalization Rate (Cap Rate):</strong> NOI divided by purchase price. Indicates operational yield. Compare to market cap rates for similar facilities.</li>
      <li><strong>Debt Service Coverage Ratio (DSCR):</strong> NOI divided by annual debt payments. Lenders typically require 1.25x-1.35x minimum for approval.</li>
      <li><strong>Projected Sale Price:</strong> Estimated exit value based on projected NOI and exit cap rate.</li>
      <li><strong>Internal Rate of Return (IRR):</strong> Time-weighted return including all cash flows and appreciation. Target 20-30%+ for strong performance.</li>
      <li><strong>Equity Multiple:</strong> Total cash returned divided by initial investment. 2.0x+ within 5-7 years considered successful.</li>
    </ul>

    <h3>Financing Car Wash Acquisitions</h3>
    <p>Multiple financing options exist for car wash investments:</p>
    <ul>
      <li><strong>SBA 7(a) Loans:</strong> Government-backed loans offering up to 90% LTV with 10-25 year terms. Competitive rates but extensive documentation and personal guarantees required. Best for owner-operators.</li>
      <li><strong>Conventional Bank Financing:</strong> 70-80% LTV with 7-20 year amortization. Requires strong credit, experience, and demonstrated cash flow. May be recourse to guarantor.</li>
      <li><strong>Seller Financing:</strong> Seller carries note for portion of purchase price (typically 10-30%). Can bridge financing gaps and demonstrate seller confidence in business.</li>
      <li><strong>Equipment Financing:</strong> Separate financing specifically for equipment (conveyors, dryers, POS systems). 5-10 year terms matching equipment life.</li>
      <li><strong>Cash Flow Lending:</strong> Specialized lenders focused on EBITDA and cash flow rather than hard assets. Higher rates but more flexible underwriting.</li>
    </ul>

    <h3>Seasonality and Weather Considerations</h3>
    <p>Car wash businesses face weather-related revenue fluctuations:</p>
    <ul>
      <li><strong>Seasonal Patterns:</strong> Spring and summer typically strongest seasons (30-40% higher volume). Winter slowest in cold climates due to snow, ice, and cold temperatures.</li>
      <li><strong>Weather Impact:</strong> Rain reduces volume 30-60% on rainy days. Snow/ice can shut down operations entirely. Extreme heat can boost volume as customers seek clean vehicles.</li>
      <li><strong>Membership Buffer:</strong> Unlimited membership programs significantly reduce weather sensitivity since revenue is collected monthly regardless of usage.</li>
      <li><strong>Geographic Variation:</strong> Southern markets have less seasonality. Northern markets experience 40-50% revenue swing between peak and trough months.</li>
      <li><strong>Indoor/Covered Design:</strong> Covered queuing and loading areas allow operations during light rain, expanding operating days.</li>
    </ul>

    <h3>Risk Factors to Consider</h3>
    <ul>
      <li><strong>Equipment Failure Risk:</strong> Mechanical breakdowns can halt operations and require expensive emergency repairs. Downtime directly impacts revenue. Preventive maintenance and equipment reserves critical.</li>
      <li><strong>Competition Risk:</strong> New car wash development can quickly oversupply market and compress pricing. Express tunnel formats proliferating rapidly in many markets.</li>
      <li><strong>Weather Risk:</strong> Extended periods of rain or severe winter weather reduce volume. No revenue on days facility cannot operate safely.</li>
      <li><strong>Water Restrictions:</strong> Drought conditions can lead to water use restrictions limiting operations. Reclaim systems provide hedge against restrictions.</li>
      <li><strong>Technology Disruption:</strong> Waterless car wash products, mobile detailing services, and autonomous vehicle cleaning systems may impact long-term demand.</li>
      <li><strong>Labor Availability:</strong> Full-service operations dependent on finding reliable labor at competitive wages. Turnover can impact service quality.</li>
      <li><strong>Environmental Compliance:</strong> Water discharge regulations, chemical handling requirements, and stormwater management compliance create ongoing obligations.</li>
    </ul>

    <h3>Value-Add Opportunities</h3>
    <p>Investors can enhance returns through strategic improvements:</p>
    <ul>
      <li><strong>Implement Membership Program:</strong> Transitioning from retail-only to membership model can increase revenue 30-60% and significantly boost valuation.</li>
      <li><strong>Technology Upgrades:</strong> Adding license plate recognition, mobile app, modern POS, and digital marketing automation improves customer experience and operational efficiency.</li>
      <li><strong>Facility Refresh:</strong> Updating signage, LED lighting, payment terminals, and customer areas improves perception and attracts customers. Modest investment with strong ROI.</li>
      <li><strong>Menu Optimization:</strong> Restructuring wash packages, adjusting pricing, and improving upsell training can lift average ticket 15-25%.</li>
      <li><strong>Add Ancillary Services:</strong> Installing pet wash stations, mat cleaners, vending machines, or detailing bays generates incremental revenue from existing traffic.</li>
      <li><strong>Operational Improvements:</strong> Optimizing chemical usage, reducing water consumption through reclaim systems, improving labor scheduling, and negotiating supplier contracts enhance margins.</li>
      <li><strong>Extended Hours:</strong> Adding early morning or evening hours captures commuter traffic and increases daily capacity utilization.</li>
    </ul>

    <h3>Tax Advantages</h3>
    <ul>
      <li><strong>Depreciation:</strong> Buildings depreciate over 39 years (commercial property). Equipment may qualify for shorter depreciation periods (5-7 years) or bonus depreciation.</li>
      <li><strong>Section 179 Deduction:</strong> Up to $1,160,000 (2023) of equipment costs can be deducted immediately rather than depreciated, improving first-year cash flow.</li>
      <li><strong>Cost Segregation:</strong> Engineering study can accelerate depreciation on electrical, plumbing, and certain building components, creating significant tax deferrals.</li>
      <li><strong>Qualified Business Income Deduction:</strong> Pass-through entities may deduct 20% of qualified business income under Section 199A, reducing effective tax rate.</li>
      <li><strong>1031 Exchange:</strong> Defer capital gains when selling car wash and acquiring another business property, enabling tax-efficient portfolio growth.</li>
    </ul>

    <h3>Due Diligence Checklist</h3>
    <p>Comprehensive due diligence is essential for car wash acquisitions:</p>
    <ul>
      <li>Review 3+ years of profit and loss statements, tax returns, and bank statements</li>
      <li>Analyze monthly revenue trends to identify seasonality patterns and growth trajectory</li>
      <li>Verify car count claims with POS data and transaction records</li>
      <li>Inspect all equipment condition and maintenance records</li>
      <li>Review utility bills (water, electric, gas) for 24 months</li>
      <li>Assess membership retention rates and churn analysis</li>
      <li>Verify all permits, licenses, and environmental compliance</li>
      <li>Conduct environmental Phase I assessment for contamination risk</li>
      <li>Review lease terms if property is leased (years remaining, renewal options, rent increases)</li>
      <li>Evaluate competition within 3-5 mile radius and upcoming developments</li>
      <li>Verify property zoning and any deed restrictions</li>
      <li>Analyze traffic counts and demographic trends</li>
      <li>Review employee agreements, pay rates, and turnover</li>
      <li>Inspect all supplier contracts and pricing agreements</li>
    </ul>

    <h3>Industry Trends Shaping Car Wash Businesses</h3>
    <ul>
      <li><strong>Unlimited Membership Dominance:</strong> Subscription model becoming industry standard with 70%+ of new express tunnels membership-focused from day one</li>
      <li><strong>Consolidation and Roll-Ups:</strong> Private equity and large operators acquiring independent washes to build regional platforms, driving up acquisition multiples</li>
      <li><strong>Express Tunnel Growth:</strong> Fast, exterior-only tunnels with free vacuums capturing market share from traditional full-service and self-serve formats</li>
      <li><strong>Technology Integration:</strong> Mobile apps, contactless payment, license plate recognition, and CRM systems becoming baseline expectations</li>
      <li><strong>Environmental Focus:</strong> Water reclamation, eco-friendly chemicals, solar power, and LED lighting appeal to environmentally conscious consumers and reduce operating costs</li>
      <li><strong>Experience Enhancement:</strong> High-quality customer experience, clean facilities, friendly staff, and premium amenities differentiating top operators</li>
      <li><strong>Flexible Formats:</strong> Hybrid models combining express exterior tunnel with optional interior services maximizing revenue per customer</li>
    </ul>

    <h3>Best Practices for Car Wash Investment Success</h3>
    <ul>
      <li>Prioritize location selection - traffic, visibility, and demographics determine 70% of success</li>
      <li>Invest in quality equipment from reputable manufacturers to minimize downtime and maintenance costs</li>
      <li>Implement unlimited membership program from start or convert existing retail business to membership model</li>
      <li>Maintain equipment proactively with daily, weekly, and monthly maintenance schedules</li>
      <li>Train staff on customer service and upselling techniques to maximize average ticket</li>
      <li>Use water reclamation systems to reduce operating costs and meet environmental regulations</li>
      <li>Leverage technology for operational efficiency: LPR, mobile apps, automated marketing</li>
      <li>Optimize pricing based on local market conditions and value proposition</li>
      <li>Build capital reserves of 3-5% of revenue annually for equipment replacement</li>
      <li>Monitor key metrics daily: car count, average ticket, membership adds/cancels, labor ratio</li>
      <li>Invest in marketing and customer acquisition, especially during launch phase</li>
      <li>Consider professional management if not operating facility yourself</li>
      <li>Plan for 3-5 year minimum hold to allow for market cycles and value creation</li>
    </ul>

    <h3>Exit Strategies and Valuation</h3>
    <p>Car wash businesses typically sell based on EBITDA multiples or cap rates:</p>
    <ul>
      <li><strong>EBITDA Multiples:</strong> Express tunnels with strong membership programs trade at 6-8x EBITDA. Full-service and self-serve at 4-6x EBITDA. New builds command premium valuations.</li>
      <li><strong>Cap Rates:</strong> Quality facilities in strong markets sell at 5-7% cap rates. Secondary markets and older facilities at 7-9% caps.</li>
      <li><strong>Strategic Buyers:</strong> Large operators and private equity groups seeking platform growth pay premium prices for well-located, well-operated assets.</li>
      <li><strong>Financial Buyers:</strong> Individual investors and small operators focus on cash flow and may be more price-sensitive but offer faster closings.</li>
      <li><strong>Seller Financing:</strong> Offering seller note for 10-20% of purchase price can attract more buyers and potentially achieve higher total price.</li>
    </ul>
  `,
  },
  calculator: {
    fields: [
      {
        name: 'purchasePrice',
        label: 'Property Purchase Price',
        type: 'number',
        defaultValue: 2500000,
      },
      {
        name: 'monthlyCarCount',
        label: 'Monthly Car Count',
        type: 'number',
        defaultValue: 6000,
      },
      {
        name: 'averageTicket',
        label: 'Average Ticket Price',
        type: 'number',
        defaultValue: 15,
      },
      {
        name: 'laborCostPercent',
        label: 'Labor Cost (%)',
        type: 'number',
        defaultValue: 18,
      },
      {
        name: 'operatingExpenseRatio',
        label: 'Operating Expense Ratio (%)',
        type: 'number',
        defaultValue: 55,
      },
      {
        name: 'monthlyMembershipRevenue',
        label: 'Monthly Membership Revenue',
        type: 'number',
        defaultValue: 25000,
      },
      {
        name: 'equipmentReserve',
        label: 'Equipment Reserve (%)',
        type: 'number',
        defaultValue: 4,
      },
      {
        name: 'downPayment',
        label: 'Down Payment (%)',
        type: 'number',
        defaultValue: 25,
      },
      {
        name: 'interestRate',
        label: 'Interest Rate (%)',
        type: 'number',
        defaultValue: 7.5,
      },
      {
        name: 'loanTerm',
        label: 'Loan Term (Years)',
        type: 'number',
        defaultValue: 20,
      },
      {
        name: 'holdingPeriod',
        label: 'Holding Period (Years)',
        type: 'number',
        defaultValue: 7,
      },
      {
        name: 'exitCapRate',
        label: 'Exit Cap Rate (%)',
        type: 'number',
        defaultValue: 6.5,
      },
    ],
    results: [
      { label: 'Gross Annual Revenue', isCurrency: true },
      { label: 'Net Operating Income', isCurrency: true },
      { label: 'Annual Cash Flow After Debt Service', isCurrency: true },
      { label: 'Cash-on-Cash Return', isPercentage: true },
      { label: 'Cap Rate', isPercentage: true },
      { label: 'Debt Service Coverage Ratio', isText: true },
      { label: 'Projected Sale Price', isCurrency: true },
      { label: 'Total Profit', isCurrency: true },
      { label: 'IRR', isPercentage: true },
      { label: 'Equity Multiple', isText: true },
    ],
    calculate: (values) => {
      const {
        purchasePrice,
        monthlyCarCount,
        averageTicket,
        laborCostPercent,
        operatingExpenseRatio,
        monthlyMembershipRevenue,
        equipmentReserve,
        downPayment,
        interestRate,
        loanTerm,
        holdingPeriod,
        exitCapRate,
      } = values;

      const retailRevenue = monthlyCarCount * averageTicket * 12;
      const membershipRevenue = monthlyMembershipRevenue * 12;
      const grossAnnualRevenue = retailRevenue + membershipRevenue;

      const operatingExpenses = grossAnnualRevenue * (operatingExpenseRatio / 100);
      const equipmentReserveAmount = grossAnnualRevenue * (equipmentReserve / 100);
      const totalExpenses = operatingExpenses + equipmentReserveAmount;
      const noi = grossAnnualRevenue - totalExpenses;

      const loanAmount = purchasePrice * (1 - downPayment / 100);
      const monthlyInterestRate = interestRate / 100 / 12;
      const numberOfPayments = loanTerm * 12;
      const monthlyPayment =
        (loanAmount * monthlyInterestRate * Math.pow(1 + monthlyInterestRate, numberOfPayments)) /
        (Math.pow(1 + monthlyInterestRate, numberOfPayments) - 1);
      const annualDebtService = monthlyPayment * 12;

      const annualCashFlow = noi - annualDebtService;
      const equity = purchasePrice * (downPayment / 100);
      const cashOnCashReturn = (annualCashFlow / equity) * 100;
      const capRate = (noi / purchasePrice) * 100;
      const dscr = noi / annualDebtService;

      const cashFlows = [-equity];
      let totalCashFlowsBeforeSale = 0;

      for (let year = 1; year <= holdingPeriod; year++) {
        const yearCashFlow = annualCashFlow;
        totalCashFlowsBeforeSale += yearCashFlow;
        cashFlows.push(yearCashFlow);
      }

      const salePrice = noi / (exitCapRate / 100);
      const remainingBalance =
        loanAmount *
        (Math.pow(1 + monthlyInterestRate, numberOfPayments) -
          Math.pow(1 + monthlyInterestRate, holdingPeriod * 12)) /
        (Math.pow(1 + monthlyInterestRate, numberOfPayments) - 1);
      const saleProceeds = salePrice - remainingBalance;
      cashFlows[cashFlows.length - 1] += saleProceeds;

      const totalProfit = saleProceeds + totalCashFlowsBeforeSale - equity;

      function calculateIRR(cashFlows: number[], guess = 0.1): number {
        const maxIterations = 1000;
        const tolerance = 0.00001;
        let rate = guess;

        for (let i = 0; i < maxIterations; i++) {
          let npv = 0;
          let dnpv = 0;

          for (let j = 0; j < cashFlows.length; j++) {
            npv += cashFlows[j] / Math.pow(1 + rate, j);
            dnpv += (-j * cashFlows[j]) / Math.pow(1 + rate, j + 1);
          }

          const newRate = rate - npv / dnpv;

          if (Math.abs(newRate - rate) < tolerance) {
            return newRate * 100;
          }

          rate = newRate;
        }

        return rate * 100;
      }

      const irr = calculateIRR(cashFlows);
      const equityMultiple = (saleProceeds + totalCashFlowsBeforeSale) / equity;

      return [
        { label: 'Gross Annual Revenue', value: grossAnnualRevenue.toFixed(2), isCurrency: true },
        { label: 'Net Operating Income', value: noi.toFixed(2), isCurrency: true },
        { label: 'Annual Cash Flow After Debt Service', value: annualCashFlow.toFixed(2), isCurrency: true },
        { label: 'Cash-on-Cash Return', value: cashOnCashReturn.toFixed(2), isPercentage: true },
        { label: 'Cap Rate', value: capRate.toFixed(2), isPercentage: true },
        { label: 'Debt Service Coverage Ratio', value: `${dscr.toFixed(2)}x`, isText: true },
        { label: 'Projected Sale Price', value: salePrice.toFixed(2), isCurrency: true },
        { label: 'Total Profit', value: totalProfit.toFixed(2), isCurrency: true },
        { label: 'IRR', value: irr.toFixed(2), isPercentage: true },
        { label: 'Equity Multiple', value: `${equityMultiple.toFixed(2)}x`, isText: true },
      ];
    },
  },
};
